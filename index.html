<!DOCTYPE html>
<html>
<head>
    <title>PDBView - Molecular Viewer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: #0f0f0f;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .viewer-section {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: #111111;
        }
        
        .controls-section {
            width: 320px;
            background: #1a1a1a;
            border-left: 1px solid #333333;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 22px;
            font-weight: 600;
            color: #ffffff;
            margin: 0;
            letter-spacing: -0.5px;
        }
        
        .header .subtitle {
            font-size: 12px;
            color: #888888;
            margin-top: 4px;
            font-weight: 300;
        }
        
        #viewer-container {
            flex: 1;
            background: #000000;
            border: 1px solid #333333;
            border-radius: 8px;
            position: relative;
            margin-bottom: 16px;
        }
        
        .control-panel {
            background: #1f1f1f;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .control-panel h3 {
            margin: 0 0 12px 0;
            font-size: 13px;
            color: #cccccc;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .control-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            font-size: 11px;
            color: #aaaaaa;
            margin-bottom: 6px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            background: #262626;
            border: 1px solid #404040;
            border-radius: 4px;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            transition: border-color 0.2s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #555555;
        }
        
        button {
            width: 100%;
            padding: 10px 12px;
            background: #2a2a2a;
            color: #ffffff;
            border: 1px solid #404040;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        button:hover {
            background: #333333;
            border-color: #555555;
        }
        
        button:active {
            background: #252525;
        }
        
        .file-input {
            position: relative;
        }
        
        .file-input input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-label {
            display: block;
            width: 100%;
            padding: 10px 12px;
            background: #262626;
            border: 1px solid #404040;
            border-radius: 4px;
            color: #aaaaaa;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .file-label:hover {
            background: #2f2f2f;
            border-color: #555555;
            color: #cccccc;
        }
        
        .status-display {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 6px;
            padding: 12px;
            font-size: 12px;
            min-height: 44px;
            color: #cccccc;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
        }
        
        .error {
            color: #ff6b6b !important;
            border-color: #ff6b6b !important;
        }
        
        .success {
            color: #51cf66 !important;
            border-color: #51cf66 !important;
        }
        
        .quick-load {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 8px;
        }
        
        .quick-load button {
            font-size: 10px;
            padding: 8px 6px;
            margin: 0;
        }
        
        .molecular-stats {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 6px;
            padding: 12px;
            font-size: 11px;
            color: #aaaaaa;
        }
        
        .stat-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-weight: 400;
        }
        
        .stat-line:last-child {
            margin-bottom: 0;
        }
        
        .stat-value {
            color: #ffffff;
            font-weight: 500;
        }
        
        /* Scrollbar styling */
        .controls-section::-webkit-scrollbar {
            width: 6px;
        }
        
        .controls-section::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .controls-section::-webkit-scrollbar-thumb {
            background: #404040;
            border-radius: 3px;
        }
        
        .controls-section::-webkit-scrollbar-thumb:hover {
            background: #555555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="viewer-section">
            <div class="header">
                <h1>PDBView</h1>
                <div class="subtitle">Molecular Structure Viewer</div>
            </div>
            <div id="viewer-container"></div>
            <div id="status-display" class="status-display">
                Ready to load molecular structure...
            </div>
        </div>
        
        <div class="controls-section">
            <div class="control-panel">
                <h3>Load Structure</h3>
                <div class="control-group">
                    <label for="pdb-id">PDB ID</label>
                    <input type="text" id="pdb-id" placeholder="e.g., 1BNA" value="1BNA">
                    <button onclick="loadPDBFromId()">Load from Database</button>
                </div>
                
                <div class="control-group">
                    <label>Upload File</label>
                    <div class="file-input">
                        <input type="file" id="pdb-file" accept=".pdb" onchange="loadPDBFromFile()">
                        <label for="pdb-file" class="file-label">Choose PDB File</label>
                    </div>
                </div>
                
                <div class="quick-load">
                    <button onclick="quickLoad('1BNA')">DNA</button>
                    <button onclick="quickLoad('1CRN')">Protein</button>
                    <button onclick="quickLoad('2IGY')">Antibody</button>
                    <button onclick="quickLoad('6VXX')">Spike</button>
                </div>
            </div>
            
            <div class="control-panel">
                <h3>Visualization</h3>
                <div class="control-group">
                    <label for="style-select">Style</label>
                    <select id="style-select" onchange="updateStyle()">
                        <option value="cartoon">Cartoon</option>
                        <option value="stick">Stick</option>
                        <option value="sphere">Sphere</option>
                        <option value="line">Line</option>
                        <option value="cross">Cross</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="color-select">Color Scheme</label>
                    <select id="color-select" onchange="updateStyle()">
                        <option value="spectrum">Spectrum</option>
                        <option value="chainHetatm">Chain</option>
                        <option value="residue">Residue</option>
                        <option value="atom">Atom Type</option>
                        <option value="white">White</option>
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                    </select>
                </div>
            </div>
            
            <div class="control-panel">
                <h3>View Controls</h3>
                <button onclick="centerView()">Center View</button>
                <button onclick="clearViewer()">Clear</button>
                <button onclick="toggleFullscreen()">Fullscreen</button>
            </div>
            
            <div class="control-panel">
                <h3>Structure Info</h3>
                <div id="molecular-stats" class="molecular-stats">
                    <div class="stat-line"><span>Status:</span><span class="stat-value">Standby</span></div>
                    <div class="stat-line"><span>Atoms:</span><span class="stat-value">--</span></div>
                    <div class="stat-line"><span>Chains:</span><span class="stat-value">--</span></div>
                    <div class="stat-line"><span>Residues:</span><span class="stat-value">--</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- include required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://3dmol.org/build/3Dmol-min.js"></script>
    
    <script>
        let viewer;
        let currentModel;
        
        $(document).ready(function() {
            // initialize the 3dmol.js viewer
            let element = $('#viewer-container');
            viewer = $3Dmol.createViewer(element, {
                defaultcolors: $3Dmol.elementColors.rasmol,
                backgroundColor: 'black'
            });
            
            // load default molecule
            loadPDBFromId();
        });
        
        function showMessage(message, type = 'info') {
            const statusDisplay = $('#status-display');
            statusDisplay.removeClass('error success');
            
            if (type === 'error') {
                statusDisplay.addClass('error');
            } else if (type === 'success') {
                statusDisplay.addClass('success');
            }
            
            statusDisplay.text(message);
        }
        
        function updateMolecularStats(model) {
            const stats = $('#molecular-stats');
            if (model) {
                const atoms = model.selectedAtoms({}).length;
                const chains = [...new Set(model.selectedAtoms({}).map(atom => atom.chain))].length;
                const residues = [...new Set(model.selectedAtoms({}).map(atom => atom.resi))].length;
                
                stats.html(`
                    <div class="stat-line"><span>Status:</span><span class="stat-value">Loaded</span></div>
                    <div class="stat-line"><span>Atoms:</span><span class="stat-value">${atoms}</span></div>
                    <div class="stat-line"><span>Chains:</span><span class="stat-value">${chains}</span></div>
                    <div class="stat-line"><span>Residues:</span><span class="stat-value">${residues}</span></div>
                `);
            } else {
                stats.html(`
                    <div class="stat-line"><span>Status:</span><span class="stat-value">Standby</span></div>
                    <div class="stat-line"><span>Atoms:</span><span class="stat-value">--</span></div>
                    <div class="stat-line"><span>Chains:</span><span class="stat-value">--</span></div>
                    <div class="stat-line"><span>Residues:</span><span class="stat-value">--</span></div>
                `);
            }
        }
        
        function quickLoad(pdbId) {
            $('#pdb-id').val(pdbId);
            loadPDBFromId();
        }
        
        function loadPDBFromId() {
            const pdbId = $('#pdb-id').val().trim().toUpperCase();
            
            if (!pdbId) {
                showMessage('Please enter a PDB ID', 'error');
                return;
            }
            
            showMessage(`Loading ${pdbId}...`);
            
            // clear previous model
            viewer.removeAllModels();
            
            // fetch pdb data from rcsb
            $.ajax({
                url: `https://files.rcsb.org/download/${pdbId}.pdb`,
                type: 'GET',
                success: function(data) {
                    try {
                        // add the molecular data to the viewer
                        currentModel = viewer.addModel(data, 'pdb');
                        
                        // apply initial styling
                        updateStyle();
                        
                        // center and render
                        viewer.zoomTo();
                        viewer.render();
                        
                        updateMolecularStats(currentModel);
                        showMessage(`${pdbId} loaded successfully`, 'success');
                    } catch (error) {
                        showMessage(`Error parsing PDB data: ${error.message}`, 'error');
                    }
                },
                error: function(xhr, status, error) {
                    showMessage(`Failed to load ${pdbId}. Please check the ID and try again.`, 'error');
                }
            });
        }
        
        function loadPDBFromFile() {
            const fileInput = $('#pdb-file')[0];
            const file = fileInput.files[0];
            
            if (!file) {
                return;
            }
            
            showMessage(`Loading ${file.name}...`);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // clear previous model
                    viewer.removeAllModels();
                    
                    // add the molecular data to the viewer
                    currentModel = viewer.addModel(e.target.result, 'pdb');
                    
                    // apply initial styling
                    updateStyle();
                    
                    // center and render
                    viewer.zoomTo();
                    viewer.render();
                    
                    updateMolecularStats(currentModel);
                    showMessage(`${file.name} loaded successfully`, 'success');
                } catch (error) {
                    showMessage(`Error parsing file: ${error.message}`, 'error');
                }
            };
            
            reader.onerror = function() {
                showMessage('Error reading file', 'error');
            };
            
            reader.readAsText(file);
        }
        
        function updateStyle() {
            if (!currentModel) {
                return;
            }
            
            const styleType = $('#style-select').val();
            const colorScheme = $('#color-select').val();
            
            // clear existing styles
            viewer.setStyle({}, {});
            
            // define style object
            let styleObj = {};
            styleObj[styleType] = { color: colorScheme };
            
            // apply the style
            viewer.setStyle({}, styleObj);
            viewer.render();
        }
        
        function centerView() {
            if (viewer) {
                viewer.zoomTo();
                viewer.render();
                showMessage('View centered', 'success');
            }
        }
        
        function clearViewer() {
            if (viewer) {
                viewer.removeAllModels();
                viewer.render();
                currentModel = null;
                updateMolecularStats(null);
                showMessage('Display cleared');
            }
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // keyboard shortcuts
        $(document).keydown(function(e) {
            // enter key to load pdb
            if (e.which === 13 && e.target.id === 'pdb-id') {
                loadPDBFromId();
            }
            
            // esc to clear
            if (e.which === 27) {
                clearViewer();
            }
        });
        
        // update file label when file is selected
        $('#pdb-file').on('change', function() {
            const fileName = this.files[0] ? this.files[0].name : 'Choose PDB File';
            $('.file-label').text(fileName.length > 25 ? fileName.substring(0, 22) + '...' : fileName);
        });
    </script>
</body>
</html>